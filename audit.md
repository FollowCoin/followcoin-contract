# FollowCoin contracts audit report 01-05.02.2018
  The purpose of this audit was to indicate the correctness of the contract’s operation, check the quality of the code and general help in further development. We propose following changes and improvements that would drastically increase further progress.
  
  This audit covered everything till commit [da8d5522ee986edc4872dbb589d5a21e93ded94d](https://github.com/FollowCoin/followcoin-contract/commit/da8d5522ee986edc4872dbb589d5a21e93ded94d).
  
## Table of contents
* [Github Repository](#github-repository)
* [JavaScript Review](#javascript-review)
* [Suggestions about contracts code](#suggestions-about-contracts-code)
* [Known security issues in context of FollowCoin](#known-security-issues-in-context-of-followcoin)
* [Security issues](#security-issues)
* [Questions for feature verification](#questions-for-feature-verification)
* [Individual test file coverage report](#individual-test-file-coverage-report)
* [Test Suite Results](#test-suite-results)
  
## Github Repository

  1. Some directories contain outdated files, like: contracts\_1 and tests\_1
  2. vs\_code directory should not be stored in repository
  3. .gitignore should be populated with proper data (like temporary files, IDEs directories etc.)
  4. Repository  should not contain **build** directory as it is generated after **truffle compile.** After removing **build** directory tests stop working. It seems that **build** directory contained some files that were not reflected by the code (that directory should be automatically generated by **truffle compile** command.
  5. File naming is not consistent i.e.: test/FollowCoin.js should be named test/testFollowCoin.js or test/FollowCoin.spec.js
  6. You should remove code that is not used and is not planned to be used

## JavaScript review

 1. Setup JavaScript/Solidity linters, such as eslint, advantages:
      1. Keeping your code style consistent
      2. Spotting potential errors and bad patterns (duplicate variables, unreachable code or invalid regular expressions)
      3. Saving time (you might uncover a bug or two on early stages, before they even reach runtime)
  on a side note: use prettier, it is a tool that will help you with formatting your code. You can run prettier from command line or use it at pre commit hook
 2. Add truffle as dependency and write scripts for it, so the developers won&#39;t need to install it globally
 3. Use ES Next features such as
    - let and const instead of var for variable declarations
    - function default parameters
    - template literals
    - async/await
    - in most places arrow you can use arrow functions instead of function declaration
 4. Write DRY code:
    - There are a lot of places where code is duplicated (we found 10^18 to be used ~20 times)
    - functions ether and coin are identical
    - come up with better variable names, b1 and b2 does say nothing to developers


  5. Script tags should be placed in head instead at the bottom of the body (add defer attribute to the tag)

  6. Missing properties in package.json: name and version.  A **package.json** must have:
      - **&quot;name&quot;**
          - all lowercase
          - one word, no spaces
          - dashes and underscores allowed
      - **&quot;version&quot;**
          - in the form of **x.x.x**
          - follows semver spec.
          - It's also good to have such fields as: author, license, contributors, description  and scripts.

      - A **package.json** file:
          - lists the packages that your project depends on.
          - allows you to specify the versions of a package that your project can use using semantic versioning rules.
          - makes your build reproducible, and therefore _much_ easier to share with other developers.

## Suggestions about contracts code:

1. Logic is very hardly visible in code. Only single contract inheritance is used which causes that main contract FollowCoin.sol has only 1 public function that doesn&#39;t tell much about logic. My suggestion is to use multiple inheritance where possible to avoid 6 elements long inheritance chain.

2. Tests seem to be only negative (are testing when functions should fail) but they should also be positive (test when function should pass)

3. Migration passed 5 arguments to contract while it expected for 0 arguments: should be fixed in this PR: [https://github.com/FollowCoin/followcoin-contract/pull/4](https://github.com/FollowCoin/followcoin-contract/pull/4)

4. Smart Contract code often is not DRY (Do not Repeat Yourself rule), for example in <strong>transferFrom</strong> function which is overloaded couple of times, but instead of having common base for those functions, each overload copies the same code and changes just one line.

5. You should use uint256 were possible as it's gas cost is lower

## Known security issues in context of FollowCoin

#### Reetrancy
Generally FollowCoin is not calling to any external smart contracts, so this attack does not apply to FollowCoin.

#### Timestamp Dependence 
There is no block.timestamp usage within followcoin contract.

#### Integer Overflow and Underflow
This attack is impossible for now, in all cases of addition or subtraction follow coin uses safemath. In one case inside migrateHolders function of MigratoryToken.sol “+” operator is used but its only available for the owner of contract. We advice to change implementation in a way that uses SafeMath add method so it won’t be possible to break this function.

#### DoS with (Unexpected) revert 
Most Denial of Service are consequences of calling to external contract’s method (fallback function in particular) which is not the case in FollowCoin (FollowCoin reverts all transactions on fallback)

#### DoS with Block Gas Limit
The only place which could be vulnerable to this attack is transferMulti function in FollowCoin because of possible big size of _values. But on the other hand it is restricted to migrationGate address there it is run only by authorized person so if it fails because of too big array it can be run again with smaller arrays

#### Forcibly Sending Ether to a Contract   
Follow coin is safe from FSE attack as it doesn’t depend on contract balance.

## Security issues

#### transferMulti function issue:

There’s no check before `for` loop that sum of `_values` does not exceed `balances[owner]`. Check at line 60 in FollowCoin.sol is very weak, it cannot determine upfront if function is receiving correct arguments. You should add assertion that check if sum of `_value` array is lesser or equal to `balances[msg.sender]`

## Questions for feature verification

#### Can you transfer the FLLWB from person A to person B?
    Yes, this is part of ERC223 interface.

#### Can person A transfer FLLWB from their MEW to person B?
    Yes, as above.

#### Can person B the received FLLWB back again to person A?
    Yes, as above.

#### Can the FLLWB coin be sent to Exchanges from MEW?
    Yes, MEW can be integrated with MetaMask which supports sending ICO tokens.

#### Can the FLLWB be bought on Exchanges?
    Currently not, it can be sold in exchanges that work on ERC223 standard.

#### Can the FLLWB be transferred from their Exchange wallet to their MEW?
    FFLWB can work with MEW for example with MetaMask as it seems to be compatible with ERC20/ERC223.

#### Is it possible to LOCK an certain amount of FLLWB for a specified amount of time?
    There's not such a functionality.

#### Is it possible to UNLOCK an certain amount of FLLWB?
    There's not such a functionality.

#### Is it possible to BURN a certain amount of FLLWB?
    Only owner of contract can burn his FLLWB.

#### Is it possible to have another (third-party) smart contract work with FLLWB?
    Yes, it will have be coded but it's possible.

#### Is it possible to create a Bounty-programme based on our current contract (or third-party) integration
    Bounty-programme could help to improve FollowCoin security, and based on it's requirements, FollowCoint fulfills all of them.

#### Is it possible to add Follow Coin Smart contract as a comment in the Smart Contract code?
    Yes, it is possible to add Follow Coint Smart Conntract as a comment, because you can add a comment to every Smart Contract Code.

#### Is the Smart Contract optimised for Exchanges?
    We haven't found any optimisation solely for exchanges.

#### Is the Smart Contract verified by a debugger (like no errors in return based on return:true values?
    It haven't been verified.

#### Does this FLLWB contract work with Ether Delta?
    We see no public data about what are requirements for ICO to work with them. We suppose being compatible with ERC223 would be enough.

#### Does this FLLWB contract work with OKEX?
    No, OKEX doesn't seem to be compatible with ERC223 tokens.

#### Does the contract include a Airdrop functionality (in case of another mistake/bug/error, and that we need FLLWC)
    No functionality like that have been found.

#### Is the FLLWB fully trade-able -> SELL/BUY/DEPOSIT/WITHDRAWL?
    Depends what do you mean. You can send your ICO tokens to everyone you want to, or exchange for ETH and as such it’s full tradeable.

#### In the process of ‘fixing’ the old contract (FLLWA), you’ve had a look into FLLWA proxy contracts. Would it be wise to make sure that our new contract (FLLWB) works with these proxy contracts?
    Generally speaking, it would be a good idea to entirely remove old contract - FLLWA. Yes it would be wise to check it.

#### Can we, with the current contract ‘retrieve’ FLLWA from the users, and can we then automatically send out FLLWB to the users? 
    No, we need the user to manually send FLLWA to our wallet to get FLLWB returned automatically.

#### Same question as above, but then in combination with the Ether Delta exchange?
    No, we use the migration webtool for this.

#### What happens when I have not exchanged my FLLWA to FLLWB and try to sent FLLWA to a future new exchange?
    If the new exchange is going to support only FLLWB than it will not recognize FLLWA.

## Individual test file coverage report

| File                         | % Statements | % Functions | % Lines |
|------------------------------|--------------|-------------|---------|
| contracts/BurnableToken.sol  |      0%      |      0%     |    0%   |
| contracts/ERC223.sol         |     100%     |     100%    |   100%  |
| contracts/ERC223Receiver.sol |      0%      |      0%     |    0%   |
| contracts/ERC223Token.sol    |    68.41%    |    85.71%   |  54.20% |
| contracts/FollowCoin.sol     |     100%     |     100%    |   100%  |
| contracts/HoldersToken.sol   |    51,61%    |     80%     |   62%   |
| contracts/MigrationAgent.sol |      0%      |      0%     |    0%   |
| contracts/Migrations.sol     |      0%      |      0%     |    0%   |
| contracts/MigratoryToken.sol |     100%     |     100%    |   100%  |
| All files                    |    46,67%    |    51,75%   |  46,24% |

## Test Suite Results

  Contract: FollowCoin
      ✓ should have set token name
      ✓ should have set token symbol
      ✓ should not accept ether

      check the transfers
        ✓ should have transfer ok (109ms)
        ✓ should have transferFrom ok with allowance (135ms)
        ✓ should have transferMulti ok (173ms)
        ✓ should have transferMulti partial ok (113ms)

      check the erc223
        ✓ should have token transfer to contract ok by default (95ms)
        ✓ should have token transfer to contract fail after erc223 activated (108ms)
        ✓ should have token transfer to erc223 receiver contract ok after erc223 activated (89ms)
        ✓ should have token transfer to contract ok after erc223 activated and whitelisted (116ms)
        ✓ should have token transfer to contract ok after erc223 activated and user whitelisted (195ms)
      check migration to FLLWc
        ✓ should have balances migrated to FLLwc (391ms)
        
## Authors
  - Jerzy Spendel [https://github.com/jerzyspendel](https://github.com/jerzyspendel)
  - Dawid Ryguła [https://github.com/Dawid-Rygula](https://github.com/Dawid-Rygula)
  - Chris Parjaszewski [https://github.com/krzysztofp](https://github.com/krzysztofp)
  - Łukasz Sojka [https://github.com/sojek](https://github.com/sojek)
  - Tomasz Ferens [https://github.com/tomaszferens](https://github.com/tomaszferens)
